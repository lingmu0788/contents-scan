# Contents Engine マスタープログラム（Hitomi）自動化ツール v2.0

会員サイトのセクションを自動で上から順番に再生する完全自動化ツールです。

## 🎯 主な機能

- ✅ **自動ログイン**
- ✅ **ビデオ終了の自動検出** - 待機時間の設定不要
- ✅ **進捗保存機能** - 途中で中断しても続きから再開可能
- ✅ **ログ出力機能** - すべての操作がログファイルに記録
- ✅ **エラーリトライ機能** - 一時的なエラーを自動リトライ
- ✅ **複数の再生ボタンパターンに対応**
- ✅ **自動ポーズ検出と再開**
- ✅ **実行結果サマリー表示**

## 📋 セットアップ手順

### 1. 仮想環境を有効化

```powershell
cd C:\Users\SS9212\projects\contents-scan\src
.\venv\Scripts\Activate.ps1
```

### 2. パッケージをインストール

```powershell
pip install -r requirements.txt
```

### 3. .env ファイルを作成

`.env.example` をコピーして `.env` ファイルを作成します：

```powershell
Copy-Item .env.example .env
```

### 4. .env ファイルを編集

`C:\Users\SS9212\projects\contents-scan\src\.env` をテキストエディタで開き、以下を編集：

```
EMAIL=your_email@example.com
PASSWORD=your_password
```

**設定値の説明：**
- `EMAIL` - 会員サイトのメールアドレス
- `PASSWORD` - 会員サイトのパスワード
- `WAIT_TIME` - ⚠️ **もう不要です！** ビデオ終了を自動検出します

## 🚀 実行方法

### 🧪 テスト版で動作確認（推奨・最初のステップ）

**長いコンテンツを全部再生する前に、まずテスト版で動作確認することを強く推奨します！**

```powershell
python main_test.py
```

**テスト版の仕様：**
- ✅ 最初の1セクションのみ実行
- ✅ 各ビデオを30秒間だけ再生してスキップ
- ✅ 最大2コンテンツまでテスト
- ✅ ログ出力あり
- ✅ 終了時にEnterキーで確認（ブラウザを見る時間がある）

### 📝 テスト版のカスタマイズ

`main_test.py` の以下の設定を変更できます：

```python
TEST_VIDEO_DURATION = 30  # ビデオを30秒だけ再生（秒数を変更可能）
MAX_TEST_CONTENTS = 2      # 最大2コンテンツまでテスト（個数を変更可能）
TEST_SECTION_INDEX = 1     # テストするセクション番号（1から始まる）
```

### 🚀 本番実行（テスト版で動作確認後）

```powershell
python main.py
```

### 実行中の操作

- **一時停止**: `Ctrl+C` を押すと安全に中断できます
- **再開**: 再度 `python main.py` を実行すると、途中から再開するか聞かれます

### 実行後

- **ログファイル**: `automation_YYYYMMDD_HHMMSS.log` に詳細ログが保存されます
- **進捗ファイル**: `progress.json` に完了したセクションが保存されます
- **結果サマリー**: 実行終了時に成功/失敗のサマリーが表示されます

## ⚠️ セキュリティについて

**重要：`.env` ファイルには認証情報が含まれます**

- ✅ `.env` ファイルは絶対に **Git にコミットしない**
- ✅ `.gitignore` で保護されています
- ✅ ローカルマシンのみで保管してください
- ✅ 他の人と共有しないでください

## 📝 トラブルシューティング

### ログインに失敗する場合
- メールアドレスとパスワードが正しいか確認
- `.env` ファイルがスペースなく正しく記載されているか確認

### ブラウザが表示されない場合
`main.py` の30行目付近のコメントを外す：
```python
options.add_argument('--headless')
```

### 再生が途中で止まる場合
- ログファイル（`automation_*.log`）を確認
- ネット接続を確認してください
- スクリプトが自動でリトライしますが、失敗する場合は再実行してください
- 進捗が保存されているため、完了済みのセクションはスキップされます

### 進捗をリセットしたい場合
`progress.json` ファイルを削除してください：
```powershell
Remove-Item progress.json
```

### 特定のセクションだけ再生したい場合
`progress.json` を編集して、スキップしたいセクション番号を追加してください

## 📞 サポート

問題が発生した場合は、ターミナルのエラーメッセージを確認してください。

---

**作成日**: 2025年12月
**対応ブラウザ**: Chrome（Chromiumベース）

